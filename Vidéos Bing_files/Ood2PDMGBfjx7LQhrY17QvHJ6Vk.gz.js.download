var MMTimer,__assign,__spreadArray,VideoEvents;(function(n){var t=function(){function n(n,t,i,r){i===void 0&&(i=!0);r===void 0&&(r=!1);this.start=function(){this.running||(this.running=!0,this.startedDate=(new Date).getTime(),this.timer=this.useInterval?setInterval(this.callback,this.timeoutMS):setTimeout(this.callback,this.remaining))};this.pause=function(){this.timer&&this.running&&(this.useInterval||(this.running=!1,clearTimeout(this.timer),this.remaining-=(new Date).getTime()-this.startedDate))};this.getTimeLeft=function(){return this.running&&(this.pause(),this.start()),this.remaining};this.getStateRunning=function(){return this.running};this.destroy=function(){this.running=!1;this.useInterval?clearInterval(this.timer):clearTimeout(this.timer);this.remaining=-1};this.callback=n;this.remaining=t;this.timeoutMS=t;this.useInterval=r;i===!0&&this.start()}return n}();n.Timer=t})(MMTimer||(MMTimer={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)};__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},function(){function gi(i){(t("started initialization",i),i&&!(i.length<2)&&i[1]&&d&&n)&&(at=i[1].videoType,p=i[1].videoExtraInfo,r=i[1].bindEventSupportedList?i[1].bindEventSupportedList:r,ei=i[1].skipPerVideoCI,i[1].videoEventsConfig&&si(i[1].videoEventsConfig),!kt&&n&&(gt(),ir()),i[1].videoDuration&&et(i),p&&cr(),t("finished initialization"),ft(i))}function nr(t){t&&!(t.length<2)&&t[1]&&d&&n&&si(t[1])}function si(n){var f,i,u;k.ciClearTimer&&typeof e==y&&typeof n==y&&JSON.stringify(e)==JSON.stringify(n)||(e=n,tt=!1,fi=(f=e.ci)===null||f===void 0?void 0:f.noci,i=e.ecietl,(i===null||i===void 0?void 0:i.length)&&(r=i),tr(),u=e.tcic,(u===null||u===void 0?void 0:u.length)&&u.forEach(function(n){var i,t=n.inm;l[t]=n;n.ft>0&&(it[t]=n.ft);rt(n.ste,t,vt);rt(n.pte,t,yt);rt(n.cte,t,pt);rt(n.utte,t,oi);wt[t]=n.efs;bt[t]=n.dfs;!tt&&((i=n.drld)===null||i===void 0?void 0:i.indexOf(b.videoPlayTime))>=0&&(tt=!0)}),t("Config: extra-CI",l))}function tr(){var n,r,i;if(k.ciClearTimer)n=Object.keys(c),(n===null||n===void 0?void 0:n.length)&&n.forEach(function(n){var i=c[n];typeof(i===null||i===void 0?void 0:i.destroy)==h&&(i.destroy(),t("clear timer (triggered by clearing video event config): "+n))});else for(r in Object.keys(c))i=c[r],typeof(i===null||i===void 0?void 0:i.destroy)==h&&(i.destroy(),t("clear timer (triggered by clearing video event config): "+r));c={};l={};a={};it={};vt={};yt={};pt={};oi={};wt={};bt={}}function rt(n,t,i){(n===null||n===void 0?void 0:n.length)&&i&&n.forEach(function(n){i[n]||(i[n]=new Set);i[n].add(t)})}function hi(n){var i=wt[n],r=bt[n],u=!1,t;if(i===null||i===void 0?void 0:i.length){for(t=0;t<i.length;t++)if(ci(i[t])){u=!0;break}}else u=!0;if(r===null||r===void 0?void 0:r.length)for(t=0;t<r.length;t++)if(ci(r[t])){u=!1;break}return u}function ci(n){if(n&&typeof _d==y&&typeof _d.querySelector==h)try{return _d.querySelector(n)}catch(i){return t("invalid selector",n),!1}}function li(n){return(n===null||n===void 0?void 0:n.size)?Array.from(n).filter(function(n){return hi(n)}):null}function ir(){(r===null||r===void 0?void 0:r.indexOf("video"))!=-1&&(sj_evt.bind(n.EmbedPlayer_ComponentUpdate,ai),sj_evt.bind(n.EmbedPlayer_Load,ft),sj_evt.bind(n.VideoCanvas_VideoPlaying,ut),sj_evt.bind(n.VideoCanvas_VideoStopped,s),sj_evt.bind(n.VideoCanvas_VideoEnded,s),sj_evt.bind(n.VideoCanvas_VideoPlayerReady,et));u&&(r===null||r===void 0?void 0:r.indexOf("preview"))!=-1&&(sj_evt.bind(u.PlayerDownloadEndEvt,vi),sj_evt.bind(u.PlayerStartEvt,ut),sj_evt.bind(u.PlayerEndEvt,s),sj_evt.bind(u.PlayerErrEvt,s),sj_evt.bind(u.PlayerPauseEvt,s),sj_evt.bind(u.StopPlayEvt,s));kt=!0;sj_be(_w,ii,gt)}function rr(){if(typeof(o===null||o===void 0?void 0:o.destroy)==h){if(nt){var n=o.getTimeLeft();o.pause();n>0&&!w&&n<di&&ni(!0)}o.destroy();t("clear video IsCI timer")}fi&&!w&&f&&ni(!1);o=null;w=!1;nt=!1}function ai(n){rr();fr(n);ur()}function ur(){v=null;dt=0}function fr(n){var u=ot(n),r=pt[u],i;(r===null||r===void 0?void 0:r.size)&&(i=Array.from(r),(i===null||i===void 0?void 0:i.length)&&i.forEach(function(n){var i=c[n],e=a[n],r,f;typeof(i===null||i===void 0?void 0:i.destroy)==h&&(r=l[n],r.atdoe>0&&(f=i.getTimeLeft(),i.pause(),f>0&&!e&&f<r.atdoe&&i.fireCallback==h&&(i.fireCallback(),a[n]=!0)),i.destroy(),t("clear timer: "+n+" by event: "+u));c[n]=null;a[n]=!1}))}function er(){if(!w){if(o)o.start();else{var n=yi();o=new d(hr,n)}t("startTimer")}}function ut(n){er();ft(n)}function ft(n){var r=ot(n),i=li(vt[r]);(i===null||i===void 0?void 0:i.length)&&i.forEach(function(i){var u=l[i];if(u)u.uvdbs&&et(n);else return;u.ft>0||(it[i]=yi());or(i,u);t("startTimer: "+i+" by event: "+r)})}function or(n,t){var r=t.uit,e=a[n],i,u,f;(!e||r)&&(i=c[n],i?i.start():(u=yr(n),f=vr(n),c[n]=new d(f,u,!0,r)))}function s(n){o===null||o===void 0?void 0:o.pause();t("pauseTimer");sr(n)}function sr(n){var r=ot(n),i=li(yt[r]);(i===null||i===void 0?void 0:i.length)&&i.forEach(function(n){var i=c[n];i&&(i.pause(),t("pauseTimer",n,r))})}function gt(){(r===null||r===void 0?void 0:r.indexOf("video"))!=-1&&(sj_evt.unbind(n.EmbedPlayer_ComponentUpdate,ai),sj_evt.unbind(n.VideoCanvas_VideoPlaying,ut),sj_evt.unbind(n.EmbedPlayer_Load,ft),sj_evt.unbind(n.VideoCanvas_VideoStopped,s),sj_evt.unbind(n.VideoCanvas_VideoEnded,s),sj_evt.unbind(n.VideoCanvas_VideoPlayerReady,et));u&&(r===null||r===void 0?void 0:r.indexOf("preview"))!=-1&&(sj_evt.unbind(u.PlayerDownloadEndEvt,vi),sj_evt.unbind(u.PlayerStartEvt,ut),sj_evt.unbind(u.PlayerEndEvt,s),sj_evt.unbind(u.PlayerErrEvt,s),sj_evt.unbind(u.PlayerPauseEvt,s),sj_evt.unbind(u.StopPlayEvt,s));kt=!1;sj_ue(_w,ii,gt)}function et(n){if(i=-1,n&&!(n.length<2)&&n[1]){var r=n[1];r.videoDuration>0&&(i=r.videoDuration*ui);switch(at){case"video":nt=i<=ct;break;case"preview":nt=i<=lt}i>ri?v="long":i>0&&(v="short");t("update duration",i,v)}}function vi(n){if(i=-1,n&&!(n.length<5)&&n[4]){var t=n[4];t>0&&(i=t*ui)}}function t(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];"object"===y&&"object"===h}function ot(n){return(n===null||n===void 0?void 0:n.length)?n[0]:""}function hr(){if(ei){t("Skip per video IsCI");return}ni(!0);t("IsCI")}function cr(){var n={TS:null,T:null,AppNS:bi},t={recoFeedbackType:null,videoExtraInfo:__assign({},p)};p&&(n=__assign(__assign({},n),p));f={j:n,r:t}}function ni(t){var r,u,o,i=f===null||f===void 0?void 0:f.j,s=f===null||f===void 0?void 0:f.r;i&&s&&(i.T=t?"IsCI":"IsNoCI",i.TS=(new Date).getTime(),((r=e===null||e===void 0?void 0:e.ci)===null||r===void 0?void 0:r.eld)&&(i=__assign(__assign({},i),e.ci.eld)),((o=(u=e===null||e===void 0?void 0:e.ci)===null||u===void 0?void 0:u.drld)===null||o===void 0?void 0:o.length)&&e.ci.drld.indexOf(b.videoSubType)>=0&&(i.videoSubType=v),s.recoFeedbackType=t?"IsCI":"IsNoCI",pInstr.icd(i),typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),sj_evt.fire(n.VideoCanvas_VideoCI,i)),w=t,(ht===null||ht===void 0?void 0:ht.ithe())&&(i.TS=null,sj_evt.fire(SharedEventString===null||SharedEventString===void 0?void 0:SharedEventString.VideoEvent_LogInst,JSON.stringify(i))))}function lr(i){var o,r=l[i],u,e,c,s;r&&hi(i)&&(u=f===null||f===void 0?void 0:f.j,u)&&(u.T=r.t,u.TS=(new Date).getTime(),e=r.ldwl,(e===null||e===void 0?void 0:e.length)&&(u=ar(u,e)),r.eld&&(u=__assign(__assign({},u),r.eld)),((o=r.drld)===null||o===void 0?void 0:o.length)&&(r.drld.indexOf(b.videoSubType)>=0&&(u.videoSubType=v),r.drld.indexOf(b.videoPlayTime)>=0&&(u[b.videoPlayTime]=dt)),pInstr.icd(u),c=r.uit,c||(a[i]=!0),t("Sent "+(r===null||r===void 0?void 0:r.t)),r.erf&&(s=f===null||f===void 0?void 0:f.r,s&&typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),t("Sent reco feedback"))))}function ar(n,t){var i={},r=__spreadArray(__spreadArray([],ki,!0),t,!0);return r.forEach(function(t){n[t]!==undefined&&n[t]!==null&&(i[t]=n[t])}),i}function vr(n){return function(){lr(n)}}function yi(){switch(at){case"video":return i>ri?g:i>0?Math.min(i,ct):ct;case"preview":return i>0?Math.min(i,lt):lt;default:return k.defaultValueUpdate?i>0?Math.min(i,g):g:Number.MAX_SAFE_INTEGER}}function yr(n){var t=it[n];return typeof t==pi?t:k.defaultValueUpdate?g:Number.MAX_SAFE_INTEGER}function pr(n){var i,t;!tt||(n===null||n===void 0?void 0:n.length)<2||(t=(i=n[1])===null||i===void 0?void 0:i.currentTime,typeof t=="number"&&t>0&&(dt=t))}var st,y="object",pi="number",h="function",wi="Video.CI",ti=typeof Multimedia==y&&typeof((st=Multimedia.Video)===null||st===void 0?void 0:st.swte)==h?Multimedia.Video.swte:function(){return!1},k={defaultValueUpdate:ti("cidfvu"),ciClearTimer:ti("cictm")},ht=typeof(Multimedia===null||Multimedia===void 0?void 0:Multimedia.MultimediaTestUtils)!="undefined"?Multimedia.MultimediaTestUtils:null,u=typeof VRHConsts!="undefined"?VRHConsts:null,n=typeof SharedEventString!="undefined"?SharedEventString:null,d=typeof MMTimer!="undefined"?MMTimer.Timer_FixPause||MMTimer.Timer:null,ii="unload",bi="video",ki=["T","TS","AppNS"],ri=3e4,g=2e4,ct=8e3,lt=8e3,ui=1e3,di=1e3,i,p,at,o,w=!1,nt=!1,f,fi=!1,r=["preview","video"],ei=!1,tt=!1,e=null,l={},c={},a={},it={},vt={},yt={},pt={},oi={},wt={},bt={},b={videoSubType:"videoSubType",videoPlayTime:"videoPlayTime"},v,kt=!1,dt;sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_InitIsCIModule,gi,!0);sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_UpdateVideoEventsConfig,nr,!0);sj_evt.bind(SharedEventString===null||SharedEventString===void 0?void 0:SharedEventString.VideoPlayer_InfoUpdate,pr,!0);t("Configurable CI loaded")}(VideoEvents||(VideoEvents={}))